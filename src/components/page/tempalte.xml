<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- tree -->
        <record id="{{id}}" model="ir.ui.view">
            <field name="name">{{name}}</field>
            <field name="model">{{model}}</field>
            <field name="arch" type="xml">
                <tree string="{{name}}" default_order="name desc" create="1" edit="1" delete="1">
                    <!-- {{string}} -->
                    <field name="{{name}}"/>
                </tree>
            </field>
        </record>


        <!-- calendar -->
        <record id="delivery_order_calendar" model="ir.ui.view">
            <field name="name">出运要求日历</field>
            <field name="model">delivery.order</field>
            <field name="arch" type="xml">
                <calendar date_start="ETD" mode="month" quick_add="0" color="customer_id">


                    <!-- 批次号 -->
                    <field name="name"/>
                    <!-- 客户 -->
                    <field name="customer_id"/>
                    <!-- 船务经办 -->
                    <field name="vessl_operator"/>

                    <!-- 状态 -->
                    <field name="state"/>

                </calendar>
            </field>
        </record>

        <!-- form -->

        <record id="delivery_order_form" model="ir.ui.view">
            <field name="name">出运要求表单</field>
            <field name="model">delivery.order</field>
            <field name="arch" type="xml">
                <form string="出运要求" create="1" edit="1" delete="1">
                    <header>
                        <button name="notice" string="通知" type="object"
                                attrs="{'invisible': [('state','!=','draft')]}"/>
                        <button name="do_revoke_notice" string="撤销通知" type="object"
                                attrs="{'invisible': [('state','!=','notify')]}"/>

                        <button name="notice" string="受理" type="object"
                                attrs="{'invisible': [('state','!=','notify')]}"/>
                        <button name="notice" string="撤销受理" type="object"
                                attrs="{'invisible': [('state','!=','accpet')]}"/>


                        <button name="outstock" string="出运" type="object"
                                attrs="{'invisible': [('state','!=','notify')]}"/>
                        <button name="outstock" string="撤销出运" type="object"
                                attrs="{'invisible': [('state','!=','outstock')]}"/>

                        <button name="notice" string="交单" type="object"
                                attrs="{'invisible': [('state','!=','outstock')]}"/>
                        <button name="notice" string="撤销交单" type="object"
                                attrs="{'invisible': [('state','!=','submit')]}"/>

                        <button name="notice" string="结案" type="object"
                                attrs="{'invisible': [('state','!=','submit')]}"/>
                        <button name="notice" string="撤销结案" type="object"
                                attrs="{'invisible': [('state','!=','case_closed')]}"/>

                        <button name="notice" string="作废" type="object"
                                attrs="{'invisible': ['|', ('state','=','invalid'),('state','=','draft')]}"/>
                        <button name="notice" string="撤销作废" type="object"
                                attrs="{'invisible': [('state','!=','invalid')]}"/>


                        <!--<button name="query_open" string="添加明细" type="object"
                                attrs="{'invisible': [('state','!=','draft')]}"/>-->

                        <button name="open_sale_order" string="添加出运明细" type="object"
                                attrs="{'invisible': [('state','!=','draft')]}"/>

                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,notify,accpet,outstock,submit,case_closed,upload,invalid"
                               readonly="1"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button
                                    attrs="{'invisible'   : []}" string="出运明细"
                                    class="oe_stat_button" name="open_undelivered" type="object" icon="fa-truck"
                                    help="出运要求明细">
                                <field string="出运明细" name="id" widget="ssTotal" total_name="delivery_order_lines_ids"/>
                            </button>

                            <button
                                    attrs="{'invisible': []}" string="货柜"
                                    class="oe_stat_button" name="open_container" type="object" icon="fa-truck"
                                    help="本次出运所对应的货柜">
                                <field string="货柜" name="display_name" widget="ssTotal" total_name="delivery_containers"/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group col="3">
                            <group col="2">
                                <!-- 客户 -->
                                <field name="customer_id"/>
                                <!-- 外销合同号 -->
                                <field name="sales_orders" widget="many2many_tags"/>
                                <!-- 包装状态 -->
                                <field name="pack_status"/>
                                <!-- 出运港 -->
                                <field name="loading_port"/>
                                <!-- 卸货港 -->
                                <field name="discharge_port"/>
                                <!-- 目的地 -->
                                <field name="delivery_place"/>
                                <!-- 运输方式 -->
                                <field name="transport_mode"/>
                                <!-- 要求创建人 -->
                                <field name="create_uid"/>
                                <!-- 船务经办 -->
                                <field name="vessl_operator"/>
                            </group>
                            <group col="2">
                                <!-- 要求开船日期 -->
                                <field name="request_shipping_date"/>
                                <!-- 等待发送日期 -->
                                <field name="cargo_ready_date"/>
                                <!-- 最终交货日期 -->
                                <!--<field name="request_cancel_date"/>-->
                                <!-- 预拖柜日期 -->
                                <!--<field name="plan_drag_cabinet_date"/>-->
                                <!-- ISF发送日期 -->
                                <!--<field name="ISF_send_date"/>-->
                                <!-- 计划船期 -->
                                <field name="ETD"/>
                                <!-- 实际船期 -->
                                <field name="ATD"/>
                                <!-- 预计结案日期 -->
                                <!--<field name="ETF"/>-->
                                <!-- 实际结案日期 -->
                                <field name="ATF"/>
                            </group>
                            <group col="2">
                                <!-- 待出数量 -->
                                <field name="undelivered_all_cnt" readonly="1"/>
                                <!-- 待出总箱数 -->
                                <field name="undelivered_box_all" readonly="1"/>
                                <!-- 待出总毛重 -->
                                <field name="undelivered_grosswgt_all" readonly="1"/>
                                <!-- 待出总体积 -->
                                <field name="undelivered_vol_all" readonly="1"/>
                                <!-- 计划总数量 -->
                                <field name="plan_delivered_all_cnt" readonly="1"/>
                                <!-- 计划总箱数 -->
                                <field name="plan_delivered_box_all" readonly="1"/>
                                <!-- 计划总毛重 -->
                                <field name="plan_delivered_grosswgt_all" readonly="1"/>
                                <!-- 计划总体积 -->
                                <field name="plan_delivered_vol_all" readonly="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="要求明细">
                                 <group col="3">
                                    <group>
                                        <!-- 散货量 -->
                                        <field name="LCL"/>
                                        <!-- FCL量 -->
                                        <field name="FCL"/>
                                    </group>
                                    <group>
                                        <!-- 20GP量 -->
                                        <field name="GP_20"/>
                                        <!-- 40GP量 -->
                                        <field name="GP_40"/>
                                    </group>
                                    <group>
                                        <!-- 40HQ量 -->
                                        <field name="HQ_40"/>
                                        <!-- 45HQ量 -->
                                        <field name="HQ_45"/>
                                    </group>
                                </group>
                                <group>
                                    <!-- 单证需求说明 -->
                                    <field name="documents_note"/>
                                </group>
                                <group>
                                    <!-- 唛头信息 -->
                                    <field name="mark_title"/>
                                </group>
                                <group>
                                    <field name="delivery_order_lines_ids">
                                        <tree string="出运要求明细" default_order="id asc" editable="bottom"
                                              create="0" edit="0" delete="0">
                                            <!-- 公司货号 -->
                                            <field name="company_code"/>
                                            <!-- 客户货号 -->
                                            <field name="custom_code"/>
                                            <!-- 英文货描 -->
                                            <field name="description_sale"/>
                                            <!-- 外销合同 -->
                                            <field name="material_info"/>
                                            <!-- 计划数量 -->
                                            <field name="plan_delivery"/>
                                            <!-- 计划箱数 -->
                                            <field name="plan_package_qty"/>
                                            <!-- 示意图 -->
                                            <field name="product_image_url" widget="ssPicture"/>
                                            <!-- 合同数量 -->
                                            <field name="sale_order_line_qty"/>
                                            <!-- 供应商 -->
                                            <field name="supplier_id"/>
                                            <!-- 待出数量 -->
                                            <field name="undelivered"/>
                                            <!-- 待出箱数 -->
                                            <field name="undelivered_package_qty"/>
                                            <!-- 待出毛重 -->
                                            <field name="undelivered_grosswgt_kg"/>
                                            <!-- 待出体积 -->
                                            <field name="undelivered_vol_cbm"/>
                                            <!--外箱装率-->
                                            <field name="out_pac_rate" invisible="1"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
                            <page string="合作伙伴">
                                <group col="2">
                                    <group>
                                        <!-- 承运人 -->
                                        <field name="carrier"/>
                                        <!-- 船公司 -->
                                        <field name="notify_party"/>
                                        <!-- 发货人 -->
                                        <field name="vessl_partner"/>
                                        <!-- 收货人 -->
                                        <field name="broker"/>
                                    </group>
                                    <group>
                                        <!-- 通知方 -->
                                        <field name="delivery_title"/>
                                        <!-- 中间商 -->
                                        <field name="declare_customer"/>
                                        <!-- 报关客户 -->
                                        <field name="consignee"/>
                                        <!-- 议付抬头 -->
                                        <field name="invoice_title"/>
                                        <!-- 付款人 -->
                                        <field name="invoice_customer"/>
                                    </group>
                                </group>
                            </page>
                            <page string="货柜信息">
                                <field name="delivery_containers">
                                    <tree editable="bottom"
                                          create="0" edit="0" delete="0">
                                        <!-- 序号 -->
                                        <field name="sequence"/>
                                        <field name="sequence" widget="handle"/>
                                        <!-- 柜型 -->
                                        <field name="container_type_id"/>
                                        <!-- 装柜日期 -->
                                        <field name="loading_date"/>
                                        <!-- 集装箱号 -->
                                        <field name="container_no"/>
                                        <!-- 铅封号 -->
                                        <field name="seal_no"/>
                                        <!-- 装柜备注 -->
                                        <field name="container_note"/>
                                        <!-- 监装人 -->
                                        <field name="supervisioner"/>
                                        <!-- 总包数 -->
                                        <field name="total_package_qty"/>
                                        <!-- 总体积 -->
                                        <field name="total_volume"/>
                                    </tree>
                                </field>

                            </page>
                            <page string="出口单证">

                            </page>
                            <page string="议付单证">

                            </page>
                            <page string="单据信息">
                                <group>
                                    <group>
                                        <field name="create_uid" string="创建人"/>
                                        <field name="write_uid" string="修改人"/>
                                    </group>
                                    <group>
                                        <field name="create_date" string="创建时间"/>
                                        <field name="write_date" string="修改时间"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- search -->

        <record id="delivery_order_search" model="ir.ui.view">
            <field name="name">出运要求搜索</field>
            <field name="model">delivery.order</field>
            <field name="arch" type="xml">
                <search string="出运要求">
                    <!-- 集装箱号 -->
                    <!--<field name="container_num"/>-->
                    <!-- 客户 -->
                    <field name="customer_id"/>
                    <!-- 客户订单号 -->
                    <!--<field name="customer_order"/>-->
                    <!-- 出运港 -->
                    <field name="loading_port"/>
                    <!-- 批次号 -->
                    <field name="name"/>
                    <!-- 提单号 -->
                    <field name="original_bl_no"/>
                    <!-- 外销合同号 -->
                    <field name="sales_orders"/>
                    <!-- 分客户 -->
                    <!--<field name="sub_customers"/>-->
                    <!-- 船务经办 -->
                    <field name="vessl_operator"/>
                    <separator/>
                    <filter name="date_ATD" string="实际船期" date="ATD"/>
                    <separator/>
                    <filter name="date_ETD" string="计划船期" date="ETD"/>
                    <separator/>
                    <filter name="pack_status_draft" string="包装状态-草拟" domain="[('pack_status', '=', 'draft')]"/>
                    <filter name="pack_status_submit" string="包装状态-提交" domain="[('pack_status', '=', 'submit')]"/>
                    <filter name="pack_status_confirm" string="包装状态-确认" domain="[('pack_status', '=', 'confirm')]"/>
                    <separator/>
                    <filter name="state_draft" string="计划" domain="[('state', '=', 'draft')]"/>
                    <filter name="state_notify" string="通知" domain="[('state', '=', 'notify')]"/>
                    <filter name="state_accpet" string="受理" domain="[('state', '=', 'accpet')]"/>
                    <filter name="state_outstock" string="出运" domain="[('state', '=', 'outstock')]"/>
                    <filter name="state_submit" string="交单" domain="[('state', '=', 'submit')]"/>
                    <filter name="state_case_closed" string="结案" domain="[('state', '=', 'case_closed')]"/>
                    <filter name="state_invalid" string="作废" domain="[('state', '=', 'invalid')]"/>
                    <separator/>
                    <filter name="undelivered_all_cnt_1" string="待出数量 > 0" domain="[('undelivered_all_cnt', '>', 0)]"/>
                    <filter name="undelivered_all_cnt_0" string="待出数量 = 0" domain="[('undelivered_all_cnt', '=', 0)]"/>
                    <separator/>
                    <group expand="1" string="分组">
                        <filter name="group_customer_id" string="客户" context="{'group_by':'customer_id'}"/>
                        <filter name="group_loading_port" string="出运港" context="{'group_by':'loading_port'}"/>
                        <filter name="group_pack_status" string="包装状态" context="{'group_by':'pack_status'}"/>
                        <!--<filter name="group_proportion" string="比例" context="{'group_by':'proportion'}"/>-->
                        <filter name="group_state" string="状态" context="{'group_by':'state'}"/>
                        <filter name="group_vessl_operator" string="船务经办" context="{'group_by':'vessl_operator'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- action -->

        <record id="delivery_order_action" model="ir.actions.act_window">
            <field name="name">出运要求</field>
            <field name="res_model">delivery.order</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="search_view_id" ref="delivery_order_search"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
            <field name="view_ids" eval="[(5, 0, 0),
           (0, 0, {'view_mode': 'tree', 'view_id': ref('delivery_order_tree')}),
           (0, 0, {'view_mode': 'form', 'view_id': ref('delivery_order_form')}),
           (0, 0, {'view_mode': 'calendar', 'view_id': ref('delivery_order_calendar')}),
    ]"/>
        </record>
    </data>
</odoo>